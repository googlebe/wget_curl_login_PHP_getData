(function(){if(!window.ucf){var AD_URL=location.protocol+"//agent.aralego.com/ad_request";var PSA_URL=location.protocol+"//psa.aralego.com/psa";var AD_VER="ADGENT_WEB-2017042801";var CLASS_BANNER="ucfad_async",CLASS_VIDEO="ucfvad";var AD_ID_PREFIX="ucfad_",AD_ID_DIGITS=8;var numVideoAdInPage=0,numBannerAdInPage=0;var adObjs=[];var _random_digits=function(n){var ret="";var d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(i=0;i<n;i++){ret+=d.charAt(Math.floor(Math.random()*d.length))}return ret};var _validateCfg=function(cfg){if(typeof cfg=="object"&&cfg!=null)return true;return false};var _getPostParams=function(adObj){var cfg=adObj.config;var params={};params["ifr"]=parent!==window?1:0;params["bl"]=navigator.language||navigator.userLanguage||"en";params["je"]=1;params["dnt"]=navigator.doNotTrack=="yes"||navigator.doNotTrack=="1"||navigator.msDoNotTrack=="1"?1:0;params["host"]=location.hostname;params["ru"]=document.referrer;params["adid"]=adObj.config.ad_unit_id;params["w"]=adObj.config.ad_width;params["h"]=adObj.config.ad_height;params["ver"]=AD_VER;params["pos"]=isElementInViewport(adObj.iFrameElm)?1:3;params["seq"]=adObj.config.seq;if(adObj.config.impr)params["impr"]=adObj.config.impr;if(adObj.config.idfa)params["udid"]=adObj.config.idfa;return params};var serialize=function(obj){var str=[];for(var p in obj){if(obj.hasOwnProperty(p)){str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]))}}return str.join("&")};function ajaxRequest(){try{var request=new XMLHttpRequest}catch(e1){try{request=new ActiveXObject("Msxml2.XMLHTTP")}catch(e2){try{request=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){request=false}}}return request}function getMSIEVersion(){var ua=window.navigator.userAgent;var msie=ua.indexOf("MSIE ");if(msie>0)return parseInt(ua.substring(msie+5,ua.indexOf(".",msie)));else return 0}function isElementInViewport(el){var rect=el.getBoundingClientRect();return rect.top>-1&&rect.bottom<=window.innerHeight}function viewportWidth(w,d){var win=w?w:window;var doc=d?d:document;if(win.innerWidth)return win.innerWidth;var html=doc&&doc.documentElement,body=doc&&(doc.body||doc.getElementsByTagName("body")[0]),getWidth=function(elm){if(!elm)return 0;var setOverflow=function(style,value){var oldValue=style.overflow;style.overflow=value;return oldValue||""},style=elm.style,oldValue=setOverflow(style,"hidden"),width=elm.clientWidth||0;setOverflow(style,oldValue);return width};return Math.max(getWidth(html),getWidth(body))}function viewportHeight(w,d){var win=w?w:window;var doc=d?d:document;if(win.innerHeight)return win.innerHeight;var html=doc&&doc.documentElement,body=doc&&(doc.body||doc.getElementsByTagName("body")[0]),getHeight=function(elm){if(!elm)return 0;var setOverflow=function(style,value){var oldValue=style.overflow;style.overflow=value;return oldValue||""},style=elm.style,oldValue=setOverflow(style,"hidden"),height=elm.clientHeight||0;setOverflow(style,oldValue);return height};return Math.max(getHeight(html),getHeight(body))}function rmislip(w,h,bg,img,iframe){if(top==self){var vpWidth=viewportWidth(),vpHeight=viewportHeight()}else{var vpWidth=viewportWidth(top.window,top.document),vpHeight=viewportHeight(top.window,top.document)}rm_screenW=1;rm_img_h=h*rm_screenW;var styleNode=document.createElement("style");styleNode.type="text/css";if(!!(window.attachEvent&&!window.opera)){styleNode.styleSheet.cssText="a img { width:"+w*rm_screenW+"px; height:"+rm_img_h+"px;}"}else{var styleText=document.createTextNode("a img { width:"+w*rm_screenW+"px; height:"+rm_img_h+"px;} ");styleNode.appendChild(styleText)}iframe.width=w*rm_screenW+"px";iframe.height=rm_img_h;bg.style.position="fixed";bg.style.top="0px";bg.style.left="0px";bg.style.width="100%";bg.style.height="100%";bg.style.display="block";bg.style.zIndex="99999999999";bg.style.backgroundImage="url('https://s.yimg.com/ja/ap/tw/bwchou/fullpage_bg.png')";bg.onclick=function(){var pn=bg.parentNode;if(pn&&pn.tagName.toLowerCase()==="ins"&&pn.className.toLowerCase()===CLASS_BANNER)pn.style.display="none";else if(pn&&pn.id.toLowerCase()==="ucfad-instl")pn.style.display="none"};img.style.position="absolute";img.style.display="block";img.style.left=(vpWidth-w*rm_screenW)/2+"px";img.style.top=(vpHeight-rm_img_h)/2+"px";img.style.width=w*rm_screenW+"px";img.style.height=rm_img_h+"px";img.style.border="0px";var closebImgWidth=35,closebImgHeight=35;var closebWidth=60,closebHeight=60;var closeb=document.createElement("DIV");bg.appendChild(closeb);closeb.style.display="block";closeb.style.cursor="pointer";closeb.style.position="fixed";closeb.style.left=Math.max(vpWidth-closebWidth,0)*rm_screenW+"px";closeb.style.top=0+"px";closeb.style.marginLeft=(closebWidth-closebImgWidth)*rm_screenW/2+"px";closeb.style.marginTop=(closebHeight-closebImgHeight)*rm_screenW/2+"px";closeb.style.width=closebImgWidth*rm_screenW+"px";closeb.style.height=closebImgWidth*rm_screenW+"px";closeb.style.background="url('https://s.yimg.com/ja/ap/hk/mobile/close_btn.png') no-repeat top right";closeb.style.backgroundSize=closeb.style.width+" "+closeb.style.height;function handleOrientation(event){if(top==self){var vpWidth=viewportWidth(),vpHeight=viewportHeight()}else{var vpWidth=viewportWidth(top.window,top.document),vpHeight=viewportHeight(top.window,top.document)}var closebWidth=60;img.style.left=(vpWidth-w*rm_screenW)/2+"px";img.style.top=(vpHeight-rm_img_h)/2+"px";closeb.style.left=Math.max(vpWidth-closebWidth,0)*rm_screenW+"px";closeb.style.top=0+"px"}addEvent(window,"orientationchange",handleOrientation);addEvent(window,"resize",handleOrientation)}function rmikill(element){if(element){var pn=element.parentNode;if(pn&&pn.tagName.toLowerCase()==="ins"&&(pn.className.toLowerCase()===CLASS_BANNER||pn.className.toLowerCase()===CLASS_VIDEO))pn.style.display="none"}}function addEvent(obj,evType,fn,isCapturing){if(isCapturing==null)isCapturing=false;if(obj.addEventListener){obj.addEventListener(evType,fn,isCapturing);return true}else if(obj.attachEvent){var r=obj.attachEvent("on"+evType,fn);return r}else{return false}}function renderAd(that,adObj){var pb=that.getResponseHeader("X-AdCloseable");if(pb!="false"){var span=document.getElementById("span_"+adObj.adid);if(span)span.style.display="inline-block"}var adType=that.getResponseHeader("X-AdStyle");var width=that.getResponseHeader("X-Width");var height=that.getResponseHeader("X-Height");var watchUrl=that.getResponseHeader("X-AdWatchUrl");adObj.iFrameElm.onload=function(){var checkVisible=function(){var rect=adObj.iFrameElm.getBoundingClientRect();var elem=document.elementFromPoint(rect.left+(rect.right-rect.left)/2,rect.top+(rect.bottom-rect.top)/2);if(elem==adObj.iFrameElm){adObj.iFrameElm.contentWindow.postMessage("visible","*");if(watchUrl&&!adObj.iFrameElm.getAttribute("data-ucfadwatched")){adObj.iFrameElm.setAttribute("data-ucfadwatched","1");var watchTrack=new ajaxRequest;watchTrack.open("GET",watchUrl,true);watchTrack.send()}return true}else{adObj.iFrameElm.contentWindow.postMessage("invisible","*");return false}};var hidden=null;var visibilityChange=null;if(typeof document.mozHidden!=="undefined"){hidden="mozHidden";visibilityChange="mozvisibilitychange"}else if(typeof document.msHidden!=="undefined"){hidden="msHidden";visibilityChange="msvisibilitychange"}else if(typeof document.webkitHidden!=="undefined"){hidden="webkitHidden";visibilityChange="webkitvisibilitychange"}else if(typeof document.hidden!=="hidden"){hidden="hidden";visibilityChange="visibilitychange"}if(hidden!=null&&visibilityChange!=null){addEvent(document,visibilityChange,function(event){if(document[hidden]===true)adObj.iFrameElm.contentWindow.postMessage("invisible","*");else checkVisible()})}checkVisible();addEvent(window,"scroll",checkVisible);addEvent(window,"resize",checkVisible)};adObj.iFrameElm.contentDocument.write(that.responseText);var fi=that.getResponseHeader("X-Finish");if(fi==="true"){adObj.iFrameElm.contentDocument.close()}if(adType=="interstitial"){var duration=parseInt(that.getResponseHeader("X-AdCap"));if(!isNaN(duration)){var exp=new Date;exp.setTime(exp.getTime()+duration*1e3);var cookie="ucfad_cap="+adObj.config.ad_unit_id+":;"+"domain="+document.domain+";expires="+exp.toGMTString();document.cookie=cookie}setTimeout(function(){if(top==self){console.log("Creative is not in iframe");rmislip(width,height,document.getElementById("ucfadbg_"+adObj.iFrameElm.id),document.getElementById("ucfadimg_"+adObj.iFrameElm.id),adObj.iFrameElm)}else{try{console.log("Try to escape friendly iframe");var instlDiv=document.createElement("DIV");instlDiv.id="ucfad-instl";top.document.body.appendChild(instlDiv);var moveTo=top.document.getElementById("ucfad-instl");moveTo.appendChild(document.getElementById("ucfadbg_"+adObj.iFrameElm.id));adObj.iFrameElm.contentDocument.write(that.responseText);rmislip(width,height,top.document.getElementById("ucfadbg_"+adObj.iFrameElm.id),top.document.getElementById("ucfadimg_"+adObj.iFrameElm.id),adObj.iFrameElm)}catch(e){console.log("Fail to escape friendly iframe")}}adObj.iFrameElm.parentNode.parentNode.parentNode.style.display="inline-block"},1e3)}}var _doPost=function(adObj){var params=_getPostParams(adObj);var IEversion=getMSIEVersion();if(3<=IEversion&&IEversion<=9){var idPrefix=adObj.adid+"_";var formStr='<form id="'+idPrefix+'form" action="'+AD_URL+'" method="Post" marginHeight="0" marginWidth="0" style="border-style: none">';for(var key in params){var inputStr='<input type="hidden" name="'+key+'" id="'+idPrefix+key+'" value="'+params[key]+'">';formStr+=inputStr}formStr+="</form>";var scriptStr='<script>window.onload=function(){document.getElementById("'+idPrefix+'form").submit()};</script>';var iframeContent=adObj.iFrameElm.contentWindow.document;iframeContent.open();iframeContent.write(formStr+scriptStr);iframeContent.close()}else{request=new ajaxRequest;paramsString=serialize(params);request.open("GET",AD_URL+"?"+paramsString,true);request.withCredentials=true;request.onreadystatechange=function(){if(this.readyState==4){if(this.status==200){console.log("Get AD");renderAd(this,adObj)}else if(this.status==204){var adType=this.getResponseHeader("X-AdStyle");if(adType=="interstitial"){var duration=parseInt(this.getResponseHeader("X-AdCap"));if(!isNaN(duration)){var exp=new Date;exp.setTime(exp.getTime()+duration*1e3);var cookie="ucfad_cap="+adObj.config.ad_unit_id+":;"+"domain="+document.domain+";expires="+exp.toGMTString();document.cookie=cookie}}rmikill(document.getElementById("ucfadbg_"+adObj.iFrameElm.id));console.log("No AD")}else{console.log("Try passback");psaRequest=new ajaxRequest;paramsString=serialize(params);psaRequest.open("GET",PSA_URL+"?"+paramsString,true);psaRequest.withCredentials=true;psaRequest.onreadystatechange=function(){if(this.readyState==4){if(this.status==200){renderAd(this,adObj)}else if(this.status==204){var adType=this.getResponseHeader("X-AdStyle");if(adType=="interstitial"){var duration=parseInt(this.getResponseHeader("X-AdCap"));if(!isNaN(duration)){var exp=new Date;exp.setTime(exp.getTime()+duration*1e3);var cookie="ucfad_cap="+adObj.config.ad_unit_id+":;"+"domain="+document.domain+";expires="+exp.toGMTString();document.cookie=cookie}}rmikill(document.getElementById("ucfadbg_"+adObj.iFrameElm.id));console.log("No AD")}}};psaRequest.send(paramsString);console.log("Ajax error:"+this.statusText)}}};request.send(paramsString)}};var _loadAd=function(adObj,cfg){if(cfg&&_validateCfg(cfg)){adObj.config=cfg}_doPost(adObj)};var _createAdObj=function(iframe,cfg){return{iFrameElm:iframe,config:cfg,getAd:function(_cfg){_loadAd(this,_cfg)}}};var checkCap=function(cfg){var s=document.cookie.indexOf("ucfad_cap=");if(s==-1)return false;var e=document.cookie.indexOf(":",s);if(e==-1)return false;var id=document.cookie.substring(s+"ucfad_cap=".length,e);if(id==cfg.ad_unit_id)return true;return false};var _insertAd=function(cfg,parent){if(typeof cfg!="object"||cfg==null){console.log("ucfad_config is not set correctly");return false}if(isNaN(parseInt(cfg.ad_width))||isNaN(parseInt(cfg.ad_height))){return false}if(checkCap(cfg)){console.log("reach the cap of ad display!!");return false}if(!parent){var scripts=document.getElementsByTagName("script");for(var i=0;i<scripts.length;i++){var script=scripts[i];var src=script.getAttribute("src");if(src&&src.indexOf("agent.aralego.com"+"/sdk")>=0&&script.getAttribute("data-ucfad-loaded")!=="done"){parent=document.createElement("div");parent.style.display="inline-block";parent.style.width=""+cfg.ad_width+"px";parent.style.height=""+cfg.ad_height+"px";script.parentNode.insertBefore(parent,script.nextSibling);script.setAttribute("data-ucfad-loaded","done");break}}}if(!parent){console.error("parent is null!");return}var adid=AD_ID_PREFIX+_random_digits(AD_ID_DIGITS);var pos=false,top=false,bottom=false,left=false,right=false;var div=document.createElement("div");div.style.display="inline-block";div.style.width=""+cfg.ad_width+"px";div.style.height=""+cfg.ad_height+"px";div.id="ucfadbg_"+adid;parent.appendChild(div);var d=document.createElement("div");d.id="ucfadimg_"+adid;div.appendChild(d);var iframe;if(navigator.appName.indexOf("Internet Explorer")!=-1){iframe=document.createElement("iframe");iframe.setAttribute("name",adid)}else{iframe=document.createElement("iframe");iframe.name=adid}iframe.id=adid;iframe.width=cfg.ad_width+"px";iframe.height=cfg.ad_height+"px";iframe.style.border="none";iframe.style.overflow="hidden";iframe.marginHeight="0";iframe.marginWidth="0";iframe.frameBorder="0";iframe.setAttribute("allowfullscreen","true");iframe.scrolling="no";iframe.className="ucfad";if(typeof cfg.sticky!="undefined"){div.style.position="fixed";div.style.zIndex=999;switch(cfg.sticky.pos){case"top":div.style.top="0px";break;case"left":div.style.left="0px";break;case"bottom":div.style.bottom="0px";break;case"right":div.style.right="0px";break}if(cfg.sticky.pos=="top"||cfg.sticky.pos=="bottom"){cfg.sticky.align=cfg.sticky.align||"center";switch(cfg.sticky.align){case"right":div.style.right="0px";break;case"center":div.style.left="50%";div.style.transform="translateX(-50%)";break;case"left":default:div.style.left="0px";break}}else if(cfg.sticky.pos=="left"||cfg.sticky.pos=="right"){div.style.top="50%";div.style.transform="translateY(-50%)"}else{div.style.bottom="0px";div.style.left="0px"}}if(cfg.closeable){var closeSpan=document.createElement("span");closeSpan.onclick=function(){div.style.display="none";var pn=div.parentNode;if(pn&&pn.tagName.toLowerCase()==="ins")pn.style.display="none"};closeSpan.id="span_"+adid;closeSpan.innerHTML="X";closeSpan.style.cssText="display:none; position: absolute;padding: 4; color: rgb(10, 0, 2); line-height: 14px; font-weight: 700;font-size: 16px;font-family: -webkit-body; border: 1px solid rgb(86, 86, 86);border-radius: 16px;box-shadow: rgba(2, 2, 2, 0.227451) 0px 0px 0px 0px;text-shadow: rgba(0, 0, 0, 0.227451) 0px 0px 0px; background-color: rgb(255, 255, 255); opacity: 0.6; cursor:hand;cursor:pointer;";d.appendChild(closeSpan)}d.appendChild(iframe);try{var doc=iframe.contentDocument}catch(e){if(!parent.getAttribute("data-ucfadstate")){parent.setAttribute("data-ucfadstate","retry error");div.removeChild(iframe);div.parentNode.removeChild(div);setTimeout(function(){_insertAd(cfg,parent)},10)}return null}parent.removeAttribute("data-ucfadstate");var ifr=document.getElementById(adid);var newObj=_createAdObj(ifr,cfg);newObj.adid=adid;adObjs.push(newObj);if(window._pxUrl){var img=new Image;img.onload=function(){newObj.getAd()};img.src=window._pxUrl}else{newObj.getAd()}return adid};var _processAds=function(params){var slots=document.getElementsByTagName("ins");for(var i=0;slots&&i<slots.length;i++){var slot=slots[i];if((slot.className===CLASS_BANNER||slot.className===CLASS_VIDEO)&&slot.getAttribute("data-ucfad-loaded")!=="done"){var cfg={};if(slot.className===CLASS_VIDEO){cfg.seq=numVideoAdInPage++}else{cfg.seq=numBannerAdInPage++}cfg.className=slot.className;cfg.ad_width=slot.style.width.replace("px","");cfg.ad_height=slot.style.height.replace("px","");cfg.ad_unit_id=slot.getAttribute("data-ad_unit_id");cfg.idfa=slot.getAttribute("data-idfa");cfg.impr=slot.getAttribute("data-impr");if(slot.getAttribute("data-closeable")!=null)cfg.closeable=true;if(slot.getAttribute("data-sticky")!=null){cfg.sticky={};slot.style.width=0;slot.style.height=0;slot.style.zIndex=999;cfg.sticky.pos=slot.getAttribute("data-sticky_pos");cfg.sticky.align=slot.getAttribute("data-sticky_align")}slot.setAttribute("data-ucfad-loaded","done");_insertAd(cfg,slot);break}}};window.ucf={processAds:_processAds,insertAd:function(cfg,parent){return _insertAd(cfg,parent)}}}if(!window.console){window.console={log:function(){}}}})();(function(){var MAX_AD_PER_PAGE=20;var queue=window.ucfad_async;if(typeof ucfad_config!=="undefined"&&ucfad_config.auto==true){window.ucf.insertAd(ucfad_config)}if(queue&&queue.shift){var task;for(var i=0;queue.length>0&&(task=queue.shift())&&i<MAX_AD_PER_PAGE;i++){window.ucf.processAds(task)}}if(!queue||!queue.loaded){window.ucfad_async={push:window.ucf.processAds,loaded:!0}}})();